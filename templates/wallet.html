{% extends "base.html" %}

{% block title %}Wallet - StreamFlix{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <!-- Balance Card -->
            <div class="card mb-4">
                <div class="card-body text-center py-5">
                    <i class="bi bi-wallet2 display-1 text-primary mb-3"></i>
                    <h3 class="card-title">Saldo StreamFlix</h3>
                    <h1 class="display-4 fw-bold text-primary my-4 user-balance">Rp {{ "{:,.0f}".format(current_user.wallet_balance) }}</h1>
                    <p class="text-muted">Gunakan saldo untuk membeli akses video premium</p>
                </div>
            </div>

            <!-- Top Up Form -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-plus-circle me-2"></i>Top Up Saldo</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('payment.topup') }}" enctype="multipart/form-data" id="topupForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="amount" class="form-label">Jumlah Top Up</label>
                                    <input type="number" class="form-control" id="amount" name="amount" 
                                           min="5000" step="1000" required>
                                    <div class="form-text">Minimum top up: Rp 5000</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="payment_method" class="form-label">Metode Pembayaran</label>
                                    <select class="form-select" id="payment_method" name="payment_method" required>
                                        <option value="">Pilih metode...</option>
                                        <option value="dana">DANA</option>
                                        <option value="ovo">OVO</option>
                                        <option value="gopay">GoPay</option>
                                        <option value="bank_transfer">Transfer Bank</option>
                                    </select>
                                    <div class="form-text">
                                        <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#paymentInstructionsModal">
                                            <i class="bi bi-info-circle me-1"></i>Lihat instruksi pembayaran
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="sender_name" class="form-label">Nama Pengirim</label>
                            <input type="text" class="form-control" id="sender_name" name="sender_name" 
                                   placeholder="Nama Anda saat transfer" required>
                            <div class="form-text">Isi nama sesuai dengan yang terdaftar di aplikasi pembayaran</div>
                        </div>

                        <div class="mb-3">
                            <label for="proof_file" class="form-label">Bukti Transfer</label>
                            <input type="file" class="form-control" id="proof_file" name="proof_file" 
                                   accept=".png,.jpg,.jpeg,.gif,.pdf,.webp" required>
                            <div class="form-text">Upload screenshot bukti transfer (PNG, JPG, PDF, max 5MB)</div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 py-2">
                            <i class="bi bi-send me-2"></i>Ajukan Top Up
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4"><!-- Payment History -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Riwayat Transaksi</h5>
    </div>
    <div class="card-body">
        {% if payments %}
            <div class="list-group list-group-flush">
                {% for payment in payments %}
                <div class="list-group-item px-0">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="mb-1">Top Up {{ payment.payment_method|upper }}</h6>
                            <small class="text-muted">{{ payment.created_at|indonesia_time }}</small>
                            {% if payment.sender_name %}
                                <br><small class="text-muted">Dari: {{ payment.sender_name }}</small>
                            {% endif %}
                        </div>
                        <div class="text-end">
                            <span class="fw-bold text-success">+Rp {{ "{:,.0f}".format(payment.amount) }}</span>
                            <br>
                            <span class="badge bg-{{ 'success' if payment.status == 'completed' else 'warning' if payment.status == 'pending' else 'danger' if payment.status == 'rejected' else 'secondary' }} badge-sm">
                                {{ payment.status|title }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- TAMBAHKAN BAGIAN INI: Tampilkan admin notes untuk status rejected -->
                    {% if payment.status == 'rejected' and payment.admin_notes %}
                        <div class="mt-2 p-2 bg-danger bg-opacity-10 rounded">
                            <small class="text-danger">
                                <i class="bi bi-exclamation-triangle me-1"></i>
                                <strong>Alasan Penolakan:</strong> {{ payment.admin_notes }}
                            </small>
                        </div>
                    {% endif %}
                    
                    {% if payment.proof_url %}
                        <div class="mt-1">
                            <small class="text-muted">
                                <i class="bi bi-paperclip me-1"></i>
                                Bukti: 
                                <a href="{{ url_for('payment.view_proof', filename=payment.proof_url) }}" 
                                   target="_blank" 
                                   class="text-info text-decoration-none">
                                    Lihat Bukti
                                </a>
                            </small>
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <i class="bi bi-receipt display-6 text-muted"></i>
                <p class="text-muted mt-2">Belum ada riwayat transaksi</p>
            </div>
        {% endif %}
    </div>
</div>
       

            <!-- Quick Actions -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6><i class="bi bi-lightning me-2"></i>Quick Actions</h6>
                    <div class="d-grid gap-2 mt-3">
                        <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#paymentInstructionsModal">
                            <i class="bi bi-telephone me-1"></i>Instruksi Pembayaran
                        </button>
                        <button type="button" class="btn btn-outline-info btn-sm" onclick="showAllPaymentMethods()">
                            <i class="bi bi-wallet2 me-1"></i>Semua Metode Pembayaran
                        </button>
                    </div>
                </div>
            </div>

            <!-- Contact Info -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6><i class="bi bi-telephone me-2"></i>Butuh Bantuan?</h6>
                    <div class="mt-3">
                        <p class="small text-muted mb-2">Hubungi admin untuk bantuan pembayaran:</p>
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-whatsapp me-2 text-success"></i>
                            <span class="small">082320781747</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-envelope me-2 text-primary"></i>
                            <span class="small">misterxyz0012@gmail.com</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Card -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6><i class="bi bi-info-circle me-2"></i>Informasi</h6>
                    <ul class="small text-muted mt-3 mb-0">
                        <li>Transfer hanya ke nomor: <strong>082320781747</strong></li>
                        <li>Saldo tidak dapat ditarik tunai</li>
                        <li>Hanya untuk pembelian video premium</li>
                        <li>Proses verifikasi 1-6 jam</li>
                        <li>Hubungi admin jika ada kendala</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modern Payment Instructions Modal -->
<div class="modal fade" id="paymentInstructionsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content glass-card">
            <div class="modal-header bg-gradient-primary text-white border-0">
                <div class="d-flex align-items-center">
                    <div class="modal-icon me-3">
                        <i class="bi bi-credit-card display-6"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-1">Instruksi Pembayaran</h5>
                        <p class="mb-0 opacity-75 small">Transfer ke nomor berikut untuk top up saldo</p>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body p-0">
                <!-- Payment Number Highlight -->
                <div class="payment-number-section bg-dark bg-opacity-25 p-4 text-center">
                    <div class="payment-number-card bg-dark rounded-3 p-4 mx-auto" style="max-width: 400px;">
                        <div class="payment-number-display">
                            <div class="number-label text-muted mb-2">
                                <i class="bi bi-telephone me-2"></i>Transfer ke nomor:
                            </div>
                            <div class="number-value display-6 fw-bold text-primary mb-3" onclick="copyPaymentNumber()" style="cursor: pointer;">
                                082320781747
                                <i class="bi bi-clipboard ms-2 fs-6 text-muted"></i>
                            </div>
                            <div class="number-info">
                                <div class="info-item d-flex align-items-center justify-content-center mb-2">
                                    <i class="bi bi-person me-2 text-success"></i>
                                    <span class="text-muted">A/N: </span>
                                    <span class="fw-semibold ms-1">STREAMFLIX OFFICIAL</span>
                                </div>
                                <div class="info-item d-flex align-items-center justify-content-center">
                                    <i class="bi bi-currency-dollar me-2 text-warning"></i>
                                    <span class="text-muted">Minimal: </span>
                                    <span class="fw-semibold ms-1 text-success">Rp 5000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods Tabs -->
                <div class="p-4">
                    <ul class="nav nav-pills nav-fill mb-4" id="paymentMethodsTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="dana-tab" data-bs-toggle="pill" data-bs-target="#dana" type="button">
                                <i class="bi bi-phone me-2"></i>DANA
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ovo-tab" data-bs-toggle="pill" data-bs-target="#ovo" type="button">
                                <i class="bi bi-phone me-2"></i>OVO
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="gopay-tab" data-bs-toggle="pill" data-bs-target="#gopay" type="button">
                                <i class="bi bi-phone me-2"></i>GoPay
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="bank-tab" data-bs-toggle="pill" data-bs-target="#bank" type="button">
                                <i class="bi bi-bank me-2"></i>Transfer Bank
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="paymentMethodsTabContent">
                        <!-- DANA Instructions -->
                        <div class="tab-pane fade show active" id="dana" role="tabpanel">
                            <div class="instruction-card">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h6 class="text-gradient mb-3">Langkah-langkah Transfer DANA:</h6>
                                        <div class="steps">
                                            <div class="step-item">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <strong>Buka aplikasi DANA</strong>
                                                    <p class="text-muted mb-0 small">Pastikan aplikasi DANA Anda sudah terinstall</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <strong>Pilih "Kirim Uang"</strong>
                                                    <p class="text-muted mb-0 small">Di menu utama aplikasi DANA</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <strong>Masukkan nomor: <span class="text-primary">082320781747</span></strong>
                                                    <p class="text-muted mb-0 small">Nomor tujuan transfer</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <strong>Masukkan jumlah top up</strong>
                                                    <p class="text-muted mb-0 small">Minimal Rp 5000</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">5</div>
                                                <div class="step-content">
                                                    <strong>Tambahkan pesan: <code class="text-success">"Top up - {{ current_user.email }}"</code></strong>
                                                    <p class="text-muted mb-0 small">Penting untuk verifikasi</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">6</div>
                                                <div class="step-content">
                                                    <strong>Konfirmasi pembayaran</strong>
                                                    <p class="text-muted mb-0 small">Selesaikan transaksi</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="quick-info-card bg-dark rounded-3 p-4 h-100">
                                            <h6 class="text-warning mb-3">
                                                <i class="bi bi-info-circle me-2"></i>Informasi Penting
                                            </h6>
                                            <ul class="list-unstyled small">
                                                <li class="mb-3">
                                                    <i class="bi bi-check-circle text-success me-2"></i>
                                                    <span>Pastikan nomor tujuan benar</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-check-circle text-success me-2"></i>
                                                    <span>Upload bukti transfer setelah bayar</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-check-circle text-success me-2"></i>
                                                    <span>Proses verifikasi 1-6 jam</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-clock text-warning me-2"></i>
                                                    <span>Saldo otomatis bertambah setelah verifikasi</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OVO Instructions -->
                        <div class="tab-pane fade" id="ovo" role="tabpanel">
                            <div class="instruction-card">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h6 class="text-gradient mb-3">Langkah-langkah Transfer OVO:</h6>
                                        <div class="steps">
                                            <div class="step-item">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <strong>Buka aplikasi OVO</strong>
                                                    <p class="text-muted mb-0 small">Pastikan aplikasi OVO Anda sudah terinstall</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <strong>Pilih "Transfer"</strong>
                                                    <p class="text-muted mb-0 small">Di menu utama aplikasi OVO</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <strong>Masukkan nomor: <span class="text-primary">082320781747</span></strong>
                                                    <p class="text-muted mb-0 small">Nomor tujuan transfer</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <strong>Masukkan jumlah top up</strong>
                                                    <p class="text-muted mb-0 small">Minimal Rp 10.000</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">5</div>
                                                <div class="step-content">
                                                    <strong>Tambahkan pesan: <code class="text-success">"Top up - {{ current_user.email }}"</code></strong>
                                                    <p class="text-muted mb-0 small">Penting untuk verifikasi</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="quick-info-card bg-dark rounded-3 p-4 h-100">
                                            <h6 class="text-warning mb-3">
                                                <i class="bi bi-lightning-charge me-2"></i>Fitur OVO
                                            </h6>
                                            <ul class="list-unstyled small">
                                                <li class="mb-3">
                                                    <i class="bi bi-arrow-clockwise text-primary me-2"></i>
                                                    <span>Transfer instan 24/7</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-shield-check text-success me-2"></i>
                                                    <span>Transaksi aman terenkripsi</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-gift text-warning me-2"></i>
                                                    <span>Tanpa biaya admin</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-clock text-info me-2"></i>
                                                    <span>Verifikasi cepat</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- GoPay Instructions -->
                        <div class="tab-pane fade" id="gopay" role="tabpanel">
                            <div class="instruction-card">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h6 class="text-gradient mb-3">Langkah-langkah Transfer GoPay:</h6>
                                        <div class="steps">
                                            <div class="step-item">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <strong>Buka aplikasi Gojek</strong>
                                                    <p class="text-muted mb-0 small">Pastikan aplikasi Gojek terupdate</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <strong>Pilih "Bayar" atau "Transfer"</strong>
                                                    <p class="text-muted mb-0 small">Di menu utama Gojek</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <strong>Scan QR atau masukkan nomor: <span class="text-primary">082320781747</span></strong>
                                                    <p class="text-muted mb-0 small">Bisa scan QR code jika tersedia</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <strong>Masukkan jumlah top up</strong>
                                                    <p class="text-muted mb-0 small">Minimal Rp 10.000</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">5</div>
                                                <div class="step-content">
                                                    <strong>Tambahkan pesan: <code class="text-success">"Top up - {{ current_user.email }}"</code></strong>
                                                    <p class="text-muted mb-0 small">Penting untuk verifikasi</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="quick-info-card bg-dark rounded-3 p-4 h-100">
                                            <h6 class="text-warning mb-3">
                                                <i class="bi bi-star me-2"></i>Keunggulan GoPay
                                            </h6>
                                            <ul class="list-unstyled small">
                                                <li class="mb-3">
                                                    <i class="bi bi-lightning text-warning me-2"></i>
                                                    <span>Transfer super cepat</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-qr-code text-primary me-2"></i>
                                                    <span>Support QR Code</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-shield-lock text-success me-2"></i>
                                                    <span>Keamanan terjamin</span>
                                                </li>
                                                <li class="mb-3">
                                                    <i class="bi bi-phone text-info me-2"></i>
                                                    <span>User-friendly interface</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Transfer Instructions -->
                        <div class="tab-pane fade" id="bank" role="tabpanel">
                            <div class="instruction-card">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h6 class="text-gradient mb-3">Langkah-langkah Transfer Bank:</h6>
                                        <div class="steps">
                                            <div class="step-item">
                                                <div class="step-number">1</div>
                                                <div class="step-content">
                                                    <strong>Buka aplikasi mobile banking</strong>
                                                    <p class="text-muted mb-0 small">Bank BCA, Mandiri, BNI, BRI, dll</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">2</div>
                                                <div class="step-content">
                                                    <strong>Pilih menu "Transfer"</strong>
                                                    <p class="text-muted mb-0 small">Antar bank atau sesama bank</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">3</div>
                                                <div class="step-content">
                                                    <strong>Masukkan nomor rekening: <span class="text-primary">082320781747</span></strong>
                                                    <p class="text-muted mb-0 small">Bank BCA</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">4</div>
                                                <div class="step-content">
                                                    <strong>Masukkan jumlah top up</strong>
                                                    <p class="text-muted mb-0 small">Minimal Rp 10.000</p>
                                                </div>
                                            </div>
                                            <div class="step-item">
                                                <div class="step-number">5</div>
                                                <div class="step-content">
                                                    <strong>Tambahkan berita: <code class="text-success">"Top up - {{ current_user.email }}"</code></strong>
                                                    <p class="text-muted mb-0 small">Penting untuk verifikasi</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="quick-info-card bg-dark rounded-3 p-4 h-100">
                                            <h6 class="text-warning mb-3">
                                                <i class="bi bi-bank me-2"></i>Informasi Rekening
                                            </h6>
                                            <div class="bank-info">
                                                <div class="info-row mb-3">
                                                    <div class="label text-muted small">Bank</div>
                                                    <div class="value fw-semibold">BCA</div>
                                                </div>
                                                <div class="info-row mb-3">
                                                    <div class="label text-muted small">Nomor Rekening</div>
                                                    <div class="value fw-semibold text-primary">082320781747</div>
                                                </div>
                                                <div class="info-row mb-3">
                                                    <div class="label text-muted small">Nama Penerima</div>
                                                    <div class="value fw-semibold">STREAMFLIX OFFICIAL</div>
                                                </div>
                                                <div class="info-row">
                                                    <div class="label text-muted small">Minimal Transfer</div>
                                                    <div class="value fw-semibold text-success">Rp 10.000</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Important Notice -->
                <div class="alert alert-warning border-0 rounded-0 m-0">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-exclamation-triangle me-3 fs-4 text-warning"></i>
                        <div>
                            <strong class="d-block mb-1">Penting!</strong>
                            <span class="small">Pastikan mengupload bukti transfer setelah melakukan pembayaran. Saldo akan ditambahkan setelah admin memverifikasi.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-2"></i>Tutup
                </button>
                <button type="button" class="btn btn-primary" onclick="copyPaymentNumber()">
                    <i class="bi bi-clipboard-check me-2"></i>Salin Nomor
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Method Select Modal -->
<div class="modal fade" id="quickMethodModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pilih Metode Pembayaran</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-6">
                        <button type="button" class="btn btn-outline-primary w-100 h-100 p-3" onclick="selectPaymentMethod('dana')">
                            <i class="bi bi-phone display-6 mb-2"></i><br>
                            <strong>DANA</strong>
                        </button>
                    </div>
                    <div class="col-6">
                        <button type="button" class="btn btn-outline-success w-100 h-100 p-3" onclick="selectPaymentMethod('ovo')">
                            <i class="bi bi-phone display-6 mb-2"></i><br>
                            <strong>OVO</strong>
                        </button>
                    </div>
                    <div class="col-6">
                        <button type="button" class="btn btn-outline-info w-100 h-100 p-3" onclick="selectPaymentMethod('gopay')">
                            <i class="bi bi-phone display-6 mb-2"></i><br>
                            <strong>GoPay</strong>
                        </button>
                    </div>
                    <div class="col-6">
                        <button type="button" class="btn btn-outline-warning w-100 h-100 p-3" onclick="selectPaymentMethod('bank_transfer')">
                            <i class="bi bi-bank display-6 mb-2"></i><br>
                            <strong>Bank Transfer</strong>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Show payment instructions when payment method is selected
document.getElementById('payment_method').addEventListener('change', function() {
    const selectedMethod = this.value;
    if (selectedMethod) {
        // Show instructions modal
        const modal = new bootstrap.Modal(document.getElementById('paymentInstructionsModal'));
        
        // Activate the corresponding tab
        const tabElement = document.getElementById(selectedMethod + '-tab');
        if (tabElement) {
            const tab = new bootstrap.Tab(tabElement);
            tab.show();
        }
        
        modal.show();
    }
});

// Copy payment number to clipboard
function copyPaymentNumber() {
    const paymentNumber = '082320781747';
    navigator.clipboard.writeText(paymentNumber).then(function() {
        // Show success message
        const copyButton = document.querySelector('#paymentInstructionsModal .btn-primary');
        const originalText = copyButton.innerHTML;
        copyButton.innerHTML = '<i class="bi bi-check-lg me-1"></i>Tersalin!';
        copyButton.classList.remove('btn-primary');
        copyButton.classList.add('btn-success');
        
        setTimeout(function() {
            copyButton.innerHTML = originalText;
            copyButton.classList.remove('btn-success');
            copyButton.classList.add('btn-primary');
        }, 2000);
    }).catch(function(err) {
        console.log('Gagal menyalin nomor: ', err);
        // Fallback untuk browser yang tidak support clipboard API
        fallbackCopyTextToClipboard(paymentNumber);
    });
}

// Fallback copy function untuk browser lama
function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.left = "-999999px";
    textArea.style.top = "-999999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            const copyButton = document.querySelector('#paymentInstructionsModal .btn-primary');
            const originalText = copyButton.innerHTML;
            copyButton.innerHTML = '<i class="bi bi-check-lg me-1"></i>Tersalin!';
            copyButton.classList.remove('btn-primary');
            copyButton.classList.add('btn-success');
            
            setTimeout(function() {
                copyButton.innerHTML = originalText;
                copyButton.classList.remove('btn-success');
                copyButton.classList.add('btn-primary');
            }, 2000);
        } else {
            alert('Gagal menyalin nomor. Silakan salin manual: ' + text);
        }
    } catch (err) {
        alert('Gagal menyalin nomor. Silakan salin manual: ' + text);
    }
    
    document.body.removeChild(textArea);
}

// Show all payment methods modal
function showAllPaymentMethods() {
    const modal = new bootstrap.Modal(document.getElementById('quickMethodModal'));
    modal.show();
}

// Select payment method from quick modal
function selectPaymentMethod(method) {
    document.getElementById('payment_method').value = method;
    
    // Close the quick modal
    const quickModal = bootstrap.Modal.getInstance(document.getElementById('quickMethodModal'));
    quickModal.hide();
    
    // Show instructions modal
    const instructionsModal = new bootstrap.Modal(document.getElementById('paymentInstructionsModal'));
    
    // Activate the corresponding tab
    const tabElement = document.getElementById(method + '-tab');
    if (tabElement) {
        const tab = new bootstrap.Tab(tabElement);
        tab.show();
    }
    
    instructionsModal.show();
}

// Auto-open instructions when page loads if no method selected
document.addEventListener('DOMContentLoaded', function() {
    const paymentMethod = document.getElementById('payment_method').value;
    if (!paymentMethod) {
        // Show quick help tooltip
        const paymentMethodSelect = document.getElementById('payment_method');
        paymentMethodSelect.title = 'Klik untuk melihat instruksi pembayaran';
        paymentMethodSelect.setAttribute('data-bs-toggle', 'tooltip');
        paymentMethodSelect.setAttribute('data-bs-placement', 'top');
        
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }
    
    // Add click event to payment number for easy copying
    const paymentNumberElements = document.querySelectorAll('.payment-number');
    paymentNumberElements.forEach(function(element) {
        element.addEventListener('click', function() {
            const number = this.textContent || this.innerText;
            copyTextToClipboard(number);
        });
    });
});

// Universal copy function
function copyTextToClipboard(text) {
    if (!navigator.clipboard) {
        fallbackCopyTextToClipboard(text);
        return;
    }
    
    navigator.clipboard.writeText(text).then(function() {
        showCopySuccess();
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        fallbackCopyTextToClipboard(text);
    });
}

function showCopySuccess() {
    // Create a temporary success message
    const successMsg = document.createElement('div');
    successMsg.className = 'alert alert-success alert-dismissible fade show position-fixed';
    successMsg.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 200px;';
    successMsg.innerHTML = `
        <i class="bi bi-check-circle me-2"></i>Nomor berhasil disalin!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(successMsg);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        if (successMsg.parentNode) {
            successMsg.parentNode.removeChild(successMsg);
        }
    }, 3000);
}

// Form validation
document.getElementById('topupForm').addEventListener('submit', function(e) {
    const amount = parseFloat(document.getElementById('amount').value);
    const method = document.getElementById('payment_method').value;
    const senderName = document.getElementById('sender_name').value;
    const file = document.getElementById('proof_file').files[0];
    
    if (amount < 5000) {
        e.preventDefault();
        showError('Minimum top up adalah Rp 5000');
        return;
    }
    
    if (!method) {
        e.preventDefault();
        showError('Pilih metode pembayaran terlebih dahulu');
        return;
    }
    
    if (!senderName.trim()) {
        e.preventDefault();
        showError('Nama pengirim harus diisi');
        return;
    }
    
    if (!file) {
        e.preventDefault();
        showError('Upload bukti transfer terlebih dahulu');
        return;
    }
    
    // Show loading
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Memproses...';
});

function showError(message) {
    // Create error alert
    const errorAlert = document.createElement('div');
    errorAlert.className = 'alert alert-danger alert-dismissible fade show position-fixed';
    errorAlert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    errorAlert.innerHTML = `
        <i class="bi bi-exclamation-triangle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(errorAlert);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (errorAlert.parentNode) {
            errorAlert.parentNode.removeChild(errorAlert);
        }
    }, 5000);
}

// Make payment numbers clickable
document.addEventListener('DOMContentLoaded', function() {
    // Add payment-number class to all payment number elements
    const paymentNumbers = document.querySelectorAll('strong:contains("082320781747")');
    paymentNumbers.forEach(function(el) {
        el.classList.add('payment-number');
        el.style.cursor = 'pointer';
        el.title = 'Klik untuk menyalin nomor';
    });
});
</script>

<style>/* Modern Payment Instructions Styles */
.modal-icon {
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
}

.payment-number-section {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    position: relative;
    overflow: hidden;
}

.payment-number-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%236366f1' fill-opacity='0.03'%3E%3Cpath d='M20 20h-4v4h4v-4zm0 0h4v-4h-4v4z'/%3E%3C/g%3E%3C/svg%3E");
}

.payment-number-card {
    border: 2px solid rgba(99, 102, 241, 0.3);
    transition: var(--transition);
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 2;
}

.payment-number-card:hover {
    border-color: var(--primary-color);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
}

.number-value {
    font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    transition: var(--transition);
    position: relative;
    cursor: pointer;
    font-weight: 700;
    letter-spacing: 1px;
}

.number-value:hover {
    transform: scale(1.08);
    text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
}

.number-value:hover::after {
    content: 'Klik untuk menyalin';
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--dark-color);
    color: var(--light-color);
    padding: 6px 12px;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    white-space: nowrap;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: var(--shadow-md);
    z-index: 10;
    animation: fadeInUp 0.3s ease-out;
}

/* Step by Step Instructions */
.steps {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.step-item {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    padding: 1.25rem;
    background: rgba(255,255,255,0.03);
    border-radius: var(--border-radius);
    border-left: 4px solid var(--primary-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.step-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
    transition: left 0.6s;
}

.step-item:hover::before {
    left: 100%;
}

.step-item:hover {
    background: rgba(99, 102, 241, 0.08);
    transform: translateX(8px);
    box-shadow: var(--shadow-sm);
}

.step-number {
    width: 36px;
    height: 36px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    transition: var(--transition);
}

.step-item:hover .step-number {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
}

.step-content {
    flex: 1;
}

.step-content strong {
    color: var(--light-color);
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    font-size: 1rem;
}

.step-content p {
    color: var(--gray-color);
    margin-bottom: 0;
    line-height: 1.5;
    font-size: 0.875rem;
}

/* Quick Info Cards */
.quick-info-card {
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(10px);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.quick-info-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--gradient-primary);
}

.quick-info-card:hover {
    border-color: rgba(99, 102, 241, 0.3);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.quick-info-card h6 {
    color: var(--light-color);
    font-weight: 600;
}

.quick-info-card ul li {
    transition: var(--transition);
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.quick-info-card ul li:last-child {
    border-bottom: none;
}

.quick-info-card ul li:hover {
    transform: translateX(5px);
}

.quick-info-card ul li i {
    transition: var(--transition);
}

.quick-info-card ul li:hover i {
    transform: scale(1.2);
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.info-row:last-child {
    border-bottom: none;
}

.info-row .label {
    flex: 1;
    color: var(--gray-color);
    font-size: 0.875rem;
}

.info-row .value {
    flex: 1;
    text-align: right;
    color: var(--light-color);
    font-weight: 600;
    font-size: 0.9rem;
}

/* Instruction Cards */
.instruction-card {
    animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Bank Info Styling */
.bank-info {
    background: rgba(255,255,255,0.03);
    border-radius: var(--border-radius);
    padding: 1.25rem;
    border: 1px solid rgba(255,255,255,0.1);
    transition: var(--transition);
}

.bank-info:hover {
    background: rgba(255,255,255,0.05);
    border-color: rgba(99, 102, 241, 0.3);
}

/* Code Styling */
code {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
    font-size: 0.85rem;
    border: 1px solid rgba(16, 185, 129, 0.3);
    font-weight: 600;
    transition: var(--transition);
}

code:hover {
    background: rgba(16, 185, 129, 0.25);
    transform: scale(1.05);
}

/* Tab Content Animation */
.tab-pane {
    animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .modal-icon {
        width: 50px;
        height: 50px;
    }
    
    .number-value {
        font-size: 1.4rem;
    }
    
    .number-value:hover::after {
        bottom: -25px;
        font-size: 0.7rem;
        padding: 4px 8px;
    }
    
    .step-item {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
        padding: 1rem;
    }
    
    .step-number {
        align-self: center;
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
    
    .modal-dialog {
        margin: 0.5rem;
    }
    
    .steps {
        gap: 1rem;
    }
    
    .quick-info-card {
        margin-top: 1rem;
    }
}

@media (max-width: 576px) {
    .number-value {
        font-size: 1.2rem;
    }
    
    .step-content strong {
        font-size: 0.9rem;
    }
    
    .step-content p {
        font-size: 0.8rem;
    }
}

/* Glass Card Enhancement */
.glass-card {
    background: rgba(30, 41, 59, 0.85);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: var(--shadow-lg);
}

.glass-card .modal-header {
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(10px);
}

/* Hover Effects */
.btn-hover-scale {
    transition: var(--transition);
    border: none;
    background: rgba(255,255,255,0.05);
    color: var(--light-color);
}

.btn-hover-scale:hover {
    transform: scale(1.03);
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

/* Text Gradient */
.text-gradient {
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

/* Additional Modern Enhancements */
.payment-method-features {
    display: grid;
    gap: 0.5rem;
}

.payment-feature {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: var(--border-radius);
    transition: var(--transition);
}

.payment-feature:hover {
    background: rgba(99, 102, 241, 0.1);
    transform: translateX(5px);
}

.payment-feature i {
    width: 20px;
    text-align: center;
    font-size: 0.9rem;
}

/* Loading state for payment processing */
.payment-processing {
    position: relative;
    overflow: hidden;
}

.payment-processing::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    100% {
        left: 100%;
    }
}

/* Success state animations */
.payment-success {
    animation: bounceIn 0.6s ease-out;
}

@keyframes bounceIn {
    0% {
        opacity: 0;
        transform: scale(0.3);
    }
    50% {
        opacity: 1;
        transform: scale(1.05);
    }
    70% {
        transform: scale(0.9);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

/* Focus states for accessibility */
.modal-content:focus-within {
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
}

/* Print styles */
@media print {
    .payment-number-section {
        background: white !important;
        border: 2px solid #333 !important;
    }
    
    .number-value {
        background: #333 !important;
        -webkit-text-fill-color: #333 !important;
        color: #333 !important;
    }
}

</style>
{% endblock %}